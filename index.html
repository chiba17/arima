<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Arima Logic 2025 - Portable</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #0f172a; color: white; font-family: sans-serif; }
    .mark-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; text-align: center; text-align-last: center; }
  </style>
</head>
<body class="p-4 max-w-4xl mx-auto">
  <header class="mb-4 border-b border-slate-700 pb-2">
    <h1 class="text-xl font-bold text-white">Arima Logic 2025 <span class="text-slate-500 text-sm">Portable</span></h1>
  </header>

  <div class="bg-slate-800 p-3 rounded-xl border border-slate-700 mb-4">
    <label class="text-xs font-bold text-slate-400 uppercase block mb-1">馬場状態</label>
    <div class="flex gap-2" id="condition-buttons">
       <button onclick="setCondition('good')" id="btn-good" class="flex-1 px-2 py-2 rounded text-sm font-bold bg-emerald-600 text-white">良 (Speed)</button>
       <button onclick="setCondition('yielding')" id="btn-yielding" class="flex-1 px-2 py-2 rounded text-sm font-bold bg-slate-800 text-slate-400 border border-slate-600">稍重</button>
       <button onclick="setCondition('soft')" id="btn-soft" class="flex-1 px-2 py-2 rounded text-sm font-bold bg-slate-800 text-slate-400 border border-slate-600">重〜不良</button>
    </div>
  </div>

  <div id="horse-list" class="space-y-3"></div>

  <script>
    const horses = [{"id":"excite","gate":1,"name":"エキサイトバイオ","jockey":"荻野極","age":3,"sex":"M","ability":84,"suitability":88,"power":82,"style":9,"achievements":"25年菊花賞(G1)3着, 3歳1勝クラス","desc":"【大穴注意】1枠1番。能力値は劣るが、最短距離を回れる物理的メリットは計り知れない。展開が崩れれば3着の目はゼロではない。","myMark":"--"},{"id":"shin","gate":2,"name":"シンエンペラー","jockey":"坂井瑠星","age":4,"sex":"M","ability":93,"suitability":94,"power":95,"style":5,"achievements":"25年ネオムターフC(G2), ホープフルS(G1)2着","desc":"【推奨】絶好の黒枠。欧州血統のパワーと先行力は、今の中山のタフな馬場に完全に合致する。内々を立ち回れば勝ち負け必至。","myMark":"--"},{"id":"justin","gate":3,"name":"ジャスティンパレス","jockey":"団野大成","age":6,"sex":"M","ability":94,"suitability":89,"power":87,"style":6,"achievements":"23年天皇賞春(G1), 神戸新聞杯(G2)","desc":"【有力】3番枠は彼にとってベスト。ズブさを補う位置取りが可能。団野騎手の手腕でロスのない競馬ができれば圏内。","myMark":"--"},{"id":"museum","gate":4,"name":"ミュージアムマイル","jockey":"Ｃ.デムーロ","age":3,"sex":"M","ability":96,"suitability":99,"power":92,"style":3,"achievements":"25年皐月賞(G1), 天皇賞秋(G1)2着","desc":"【本命級】皐月賞と同じ2枠4番。先行して抜け出す王道競馬が可能。3歳56kgの恩恵と、絶対的なコース適性で古馬を圧倒する。","myMark":"--"},{"id":"regaleira","gate":5,"name":"レガレイラ","jockey":"Ｃ.ルメール","age":4,"sex":"F","ability":98,"suitability":86,"power":83,"style":9,"achievements":"24年有馬記念(G1), ホープフルS(G1)","desc":"【高評価】能力はNo.1。後方脚質だが、ルメール騎手が5番枠からどう捌くか。中団につけられれば連覇は堅い。","myMark":"--"},{"id":"meisho","gate":6,"name":"メイショウタバル","jockey":"武豊","age":4,"sex":"M","ability":89,"suitability":85,"power":89,"style":0,"achievements":"25年宝塚記念(G1), 毎日杯(G3)","desc":"【展開の鍵】レジェンド武豊の手綱捌きでハナへ。マイペースなら残り目もあるが、マークは厳しくなる。","myMark":"--"},{"id":"sunrise_z","gate":7,"name":"サンライズジパング","jockey":"鮫島克駿","age":4,"sex":"M","ability":86,"suitability":86,"power":94,"style":6,"achievements":"みやこS(G3), 若駒S(L)","desc":"【重巧者】パワー型。馬場が渋れば評価急上昇。良馬場だとスピード負けする懸念あり。消耗戦なら浮上。","myMark":"--"},{"id":"chevalier","gate":8,"name":"シュヴァリエローズ","jockey":"北村友一","age":7,"sex":"M","ability":80,"suitability":81,"power":79,"style":4,"achievements":"京都記念(G2)3着","desc":"ベテランの味があるが、G1のここでは物理的能力値で見劣りする。展開の助けがあっても掲示板までか。","myMark":"--"},{"id":"danon","gate":9,"name":"ダノンデサイル","jockey":"戸崎圭太","age":4,"sex":"M","ability":95,"suitability":96,"power":88,"style":4,"achievements":"24年日本ダービー(G1), 京成杯(G3)","desc":"【対抗】ダービー馬。5枠9番は前に壁を作りやすく、かつ動きたい時に動ける好枠。操縦性の高さで中山を攻略する。","myMark":"--"},{"id":"cosmo","gate":10,"name":"コスモキュランダ","jockey":"横山武史","age":4,"sex":"M","ability":89,"suitability":97,"power":87,"style":8,"achievements":"弥生賞(G2), 皐月賞(G1)2着","desc":"【特注】中山マイスター。外目の枠だが、向こう正面から捲る彼にとっては動きやすい。横山武騎手の積極策に期待。","myMark":"--"},{"id":"mystery","gate":11,"name":"ミステリーウェイ","jockey":"松本大輝","age":7,"sex":"G","ability":78,"suitability":75,"power":85,"style":1,"achievements":"3勝クラス","desc":"外枠の逃げ馬は厳しい。ハナを主張すればスタミナを浪費し、控えれば持ち味が出ない。苦戦必至。","myMark":"--"},{"id":"meiner","gate":12,"name":"マイネルエンペラー","jockey":"丹内祐次","age":5,"sex":"M","ability":81,"suitability":84,"power":90,"style":7,"achievements":"3勝クラス","desc":"ゴールドシップ産駒。雨なら一考。良馬場スピード勝負では分が悪い。展開待ちの他力本願にならざるを得ない。","myMark":"--"},{"id":"admire","gate":13,"name":"アドマイヤテラ","jockey":"川田将雅","age":4,"sex":"M","ability":88,"suitability":88,"power":91,"style":5,"achievements":"茶臼山高原特別(2勝), 阿寒湖特別(2勝)","desc":"【危険】7枠に入ったことで距離ロスのリスク増大。川田騎手でも外々を回らされるとG1級相手には厳しい。","myMark":"--"},{"id":"arata","gate":14,"name":"アラタ","jockey":"大野拓弥","age":8,"sex":"M","ability":77,"suitability":85,"power":82,"style":5,"achievements":"金杯(G3)3着","desc":"8歳馬に7枠14番は酷。中山実績はあるが、物理的なピークアウトを迎えており、ここでの好走確率は統計的に低い。","myMark":"--"},{"id":"elton","gate":15,"name":"エルトンバローズ","jockey":"西村淳也","age":5,"sex":"M","ability":89,"suitability":80,"power":78,"style":3,"achievements":"毎日王冠(G2)","desc":"【消し】8枠15番は「死の枠」。距離適性の不安に加え、物理的な距離ロスが重なる二重苦。能力だけで覆すのは困難。","myMark":"--"},{"id":"tastiera","gate":16,"name":"タスティエーラ","jockey":"松山弘平","age":5,"sex":"M","ability":90,"suitability":92,"power":88,"style":4,"achievements":"23年日本ダービー(G1)","desc":"【大減点】大外16番。中山巧者だが、この枠は絶望的。最初のコーナーまでに好位を取ろうとすれば脚を使い、控えれば届かない。","myMark":"--"}];
    let currentCondition = 'good';
    
    // Simple clone to avoid reference issues
    let currentHorses = JSON.parse(JSON.stringify(horses));

    const MARKS = [
        { label: '--', color: 'bg-slate-700 text-slate-400 border-slate-600' },
        { label: '◎', color: 'bg-white text-red-600 border-red-600 font-extrabold' },
        { label: '◯', color: 'bg-white text-blue-600 border-blue-600 font-extrabold' },
        { label: '▲', color: 'bg-white text-black border-black font-extrabold' },
        { label: '△', color: 'bg-white text-black border-black font-normal' },
        { label: '☆', color: 'bg-yellow-400 text-black border-yellow-500 font-extrabold' },
        { label: '消', color: 'bg-gray-400 text-gray-700 border-gray-500' },
    ];

    function getStyleLabel(style) {
        if (style <= 1) return { label: '逃げ', color: 'bg-orange-500' };
        if (style <= 4) return { label: '先行', color: 'bg-emerald-500' };
        if (style <= 7) return { label: '差し', color: 'bg-blue-500' };
        return { label: '追込', color: 'bg-purple-500' };
    }

    function getWeight(age, sex) {
        let weight = 58;
        if (age === 3) weight = 56;
        if (sex === 'F') weight -= 2;
        return weight + 'kg';
    }

    function getGateColor(gate) {
        if (gate === 1 || gate === 2) return 'bg-white text-gray-900 border-gray-300';
        if (gate === 3 || gate === 4) return 'bg-gray-900 text-white border-gray-600';
        if (gate === 5 || gate === 6) return 'bg-red-600 text-white border-red-500';
        if (gate === 7 || gate === 8) return 'bg-blue-600 text-white border-blue-500';
        if (gate === 9 || gate === 10) return 'bg-yellow-400 text-gray-900 border-yellow-300';
        if (gate === 11 || gate === 12) return 'bg-green-600 text-white border-green-500';
        if (gate === 13 || gate === 14) return 'bg-orange-500 text-white border-orange-400';
        if (gate === 15 || gate === 16) return 'bg-pink-400 text-white border-pink-300';
        return 'bg-slate-700 text-white';
    }

    function getMarkStyle(label) {
        const m = MARKS.find(m => m.label === label);
        return m ? m.color : MARKS[0].color;
    }

    function calculate(horse, cond) {
        const gate = horse.gate;
        let gateScore = 0;
        if (gate <= 6) gateScore = 15;
        else if (gate <= 10) gateScore = 5;
        else if (gate <= 14) gateScore = -10;
        else gateScore = -20;

        let baseCapability = 0;
        let trackComment = "";

        if (cond === 'good') {
            baseCapability = (horse.ability * 0.7) + (horse.suitability * 0.3);
        } else if (cond === 'yielding') {
            baseCapability = (horse.ability * 0.4) + (horse.power * 0.3) + (horse.suitability * 0.3);
        } else {
            baseCapability = (horse.power * 0.6) + (horse.suitability * 0.4);
        }

        let riskPenalty = 0;
        if (gate >= 13 && horse.style <= 3) riskPenalty -= 3;
        if (gate <= 4 && horse.style >= 8) riskPenalty -= 2;
        if (horse.age === 3) riskPenalty += 2;
        if (horse.id === 'meisho' && gate <= 6) riskPenalty += 2;

        const totalScore = baseCapability + gateScore + riskPenalty;
        let grade = 'C';
        if (totalScore >= 108) grade = 'S';
        else if (totalScore >= 100) grade = 'A';
        else if (totalScore >= 92) grade = 'B';
        else if (totalScore >= 84) grade = 'C';
        else grade = 'D';
        
        let suitabilityScore = 0;
        if (cond === 'good') suitabilityScore = horse.ability;
        else if (cond === 'yielding') suitabilityScore = (horse.ability + horse.power) / 2;
        else suitabilityScore = horse.power;
        
        let suitabilityRank = "B";
        if (suitabilityScore >= 95) suitabilityRank = "S";
        else if (suitabilityScore >= 90) suitabilityRank = "A";
        else if (suitabilityScore >= 85) suitabilityRank = "B";
        else if (suitabilityScore >= 80) suitabilityRank = "C";
        else suitabilityRank = "D";

        return { grade, score: total, trackComment, suitabilityRank };
    }

    function setCondition(cond) {
        currentCondition = cond;
        ['good','yielding','soft'].forEach(c => {
            const btn = document.getElementById('btn-'+c);
            if(c === cond) btn.className = 'flex-1 px-2 py-2 rounded text-sm font-bold bg-emerald-600 text-white transition-all';
            else btn.className = 'flex-1 px-2 py-2 rounded text-sm font-bold bg-slate-800 text-slate-400 border border-slate-600 transition-all';
        });
        render();
    }

    function updateMark(id, val) {
        const h = currentHorses.find(x => x.id === id);
        if(h) h.myMark = val;
        render();
    }

    function render() {
        const container = document.getElementById('horse-list');
        container.innerHTML = '';
        
        const sorted = [...currentHorses].sort((a,b) => {
            const resA = calculate(a, currentCondition);
            const resB = calculate(b, currentCondition);
            return resB.score - resA.score;
        });

        const colors = { S: 'bg-yellow-500 text-black', A: 'bg-red-500 text-white', B: 'bg-blue-500 text-white', C: 'bg-gray-500 text-white', D: 'bg-slate-700 text-gray-300' };

        sorted.forEach(h => {
            const res = calculate(h, currentCondition);
            const badgeClass = colors[res.grade];
            const style = getStyleLabel(h.style);
            const gateColor = getGateColor(h.gate);
            const markStyle = getMarkStyle(h.myMark);
            
            const markOptions = MARKS.map(m => `<option value="${m.label}" ${m.label===h.myMark?'selected':''}>${m.label}</option>`).join('');

            const div = document.createElement('div');
            div.className = 'bg-slate-800 rounded-xl border border-slate-700 p-4 flex flex-col sm:flex-row items-center gap-4';
            div.innerHTML = `
                <div class="flex-shrink-0 ${badgeClass} w-16 h-16 rounded-lg flex items-center justify-center text-3xl font-bold shadow-lg">${res.grade}</div>
                <div class="flex-grow min-w-0 pt-1 sm:pt-0">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="flex-shrink-0 text-xs font-bold px-2 py-0.5 rounded text-white ${style.color}">${style.label}</span>
                        <h3 class="font-bold text-white text-base leading-none truncate">${h.name}</h3>
                        <span class="text-xs text-slate-400">(${h.jockey})</span>
                        <span class="flex-shrink-0 text-xs text-slate-400 bg-slate-800 px-2 py-0.5 rounded border border-slate-700">${getWeight(h.age, h.sex)}</span>
                    </div>
                    <div class="flex flex-col gap-1 text-sm text-slate-400">
                        <div class="flex items-center gap-3">
                             <span class="font-mono text-emerald-400 font-bold">Score: ${res.score.toFixed(0)}</span>
                             <span class="text-xs bg-slate-700 text-slate-300 px-2 py-0.5 rounded">適性ランク: ${res.suitabilityRank}</span>
                        </div>
                        <div class="text-xs opacity-80 border-l-2 border-slate-600 pl-2 mt-1 truncate">${h.desc}</div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                     <select onchange="updateMark('${h.id}', this.value)" class="mark-select w-10 h-10 rounded border ${markStyle} text-sm font-bold focus:outline-none cursor-pointer text-slate-900" style="color: ${h.myMark === '--' ? '#94a3b8' : 'inherit'}">
                        ${markOptions}
                     </select>
                     <div class="${gateColor} w-8 h-8 rounded flex items-center justify-center font-bold text-sm border shadow-sm">
                        ${h.gate}
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    }

    render();
  </script>
</body>
</html>